<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<style>
.ctextrg{
	text-align: right;
}
.w133{
	width: 133px;
}
.w266{
	width: 266px;
}
.hideContent{
	overflow: hidden;
	text-overflow:ellipsis;
	white-space:nowrap;
}
</style>
	<div class="div div-1">
		<div class="title title-1">
			<h3>
					<img src='../images/fold.png' onclick="showAndHide(this,'examine_grid');"  class="imgShrotate">
					<font>筛选项</font>
			</h3>
		</div>
	<div class="div-main-1" >
			<table cellpadding="0" cellspacing="0" border="0" class="table-1" style="height: 120px;font-size: 150%">
				<tr>
					<td width="10%" align="right">
						 <label for="input_1" class="lbl-1" style="width: 15%;font-size: 75%">申请账号昵称：</label>
					</td>
					<td width="13%" align="left">
						<input type="text"
						id="txt_apply_nickname" name="txt_apply_nickname" class="wi-ipt-1" style="width: 80%"/>
					</td>
					<td width="10%" align="right">
						<label for="input_1" class="lbl-1" style="width: 15%;font-size: 75%">是否测试账号：</label>
					</td>
					<td width="13%" align="left">
						<select
						name="txt_istest_admin" id="txt_istest_admin" style="width: 80%">
							<option value="">全部</option>
							<option value="内部用户">是</option>
							<option value="注册用户">否</option>
						</select>
					</td>
					<td width="8%" align="right">
						<label for="input_1" class="lbl-1" style="width: 15%;font-size: 75%">审核状态：</label>
					</td>
					<td width="13%" align="left">
						<select
						name="txt_examine_status" id="txt_examine_status" class="wi-sel-1" style="width: 80%">
							<option value="">全部</option>
							<option value="0">申请取消</option>
							<option value="1">认证通过</option>
							<option value="2">审核中</option>
							<option value="3">认证失败</option>
							<option value="4">待审核</option>
						</select>
					</td>
					<td width="7%" align="right">
						<label for="input_1" class="lbl-1" style="width: 15%;font-size: 75%">公司名称：</label>
					</td>
					<td width="13%" align="left">
						<input type="text" style="width: 80%"
						id="txt_company_name" name="txt_company_name" class="wi-ipt-1" />
					</td>
					<td width="7%" align="right">
						<label for="input_1" class="lbl-1" style="width: 15%;font-size: 75%">注册地：</label>
					</td>
					<td width="13%" align="left">
						<select style="width: 80%"
						name="txt_resident_address" id="txt_resident_address"
						class="wi-sel-1" >
							<option value="">全部</option>
							<option value="1">境内</option>
							<option value="2">境外</option>
						</select>
					</td>
				</tr>
				<tr>
					<td align="right">
						<label for="input_1" class="lbl-1" style="width: 15%;font-size: 75%">法定代表人：</label>
					</td>
					<td align="left">
						<input type="text" style="width: 80%"
						id="txt_legal_person" name="txt_legal_person" class="wi-ipt-1" />
					</td>
					<td align="right" >
						<label for="input_1" class="lbl-1" style="width: 15%;font-size: 75%">组织机构号：</label>
					</td>
					<td align="left">
						<input type="text" style="width: 80%"
						id="txt_organization_no" name="txt_organization_no"
						class="wi-ipt-1" />
					</td>
					<td align="right" >
						<label for="input_1" class="lbl-1" style="width: 15%;font-size: 75%">税务登记号：</label>
					</td>
					<td align="left">
						<input type="text" style="width: 80%"
						id="txt_taxRegistration_no" name="txt_taxRegistration_no"
						class="wi-ipt-1" />
					</td>
					<td align="right" >
						<label for="input_1" class="lbl-1" style="width: 15%;font-size: 75%">营业执照号：</label>
					</td>
					<td align="left">
						<input type="text" style="width: 80%"
						id="txt_businessLicense_no" name="txt_businessLicense_no"
						class="wi-ipt-1" />
					</td>
					<td align="right" >
						<label for="input_1" class="lbl-1" style="width: 15%;font-size: 75%">申请账号ID：</label>
					</td>
					<td align="left">
						<input type="text" style="width: 80%"
						id="txt_apply_id" name="txt_apply_id" class="wi-ipt-1" />
					</td>
				</tr>
				<tr >
					<td align="right">
						<label for="input_1" class="lbl-1" style="width: 15%;font-size: 75%">手机号码：</label>
					</td>
					<td align="left">
						<input type="text" style="width: 80%"
						id="txt_apply_phone" name="txt_apply_phone" class="wi-ipt-1" />
					</td>
					<td align="right">
						<label for="input_1" class="lbl-1" style="width: 15%;font-size: 75%">联系QQ：</label>
					</td>
					<td align="left">
						<input type="text" style="width: 80%"
						id="txt_contacts_qq" name="txt_contacts_qq" class="wi-ipt-1" />
					</td>
					<td align="right">
						<label for="input_1" class="lbl-1" style="width: 15%;font-size: 75%">所在地：</label>
					</td>
					<td align="left">
						<input type="text" style="width: 80%"
						id="txt_sz_address" name="txt_sz_address" class="wi-ipt-1" />
					</td>	
					<td align="right">
						<label for="input_1" class="lbl-1" style="width: 15%;font-size: 75%">业务员：</label>
					</td>
					<td align="left">
						<input type="text" style="width: 80%"
						id="txt_sales_man" name="txt_sales_man" class="wi-ipt-1" />
					</td>
					<td align="right">
						<label for="input_1" class="lbl-1" style="width: 15%;font-size: 75%">审核人：</label>
					</td>
					<td align="left">
						<input type="text" style="width: 80%"
						id="txt_approved_man" name="txt_approved_man" class="wi-ipt-1" />
					</td>
				</tr>
				<tr>
					<td colspan="5" align="left"><label for="input_1" style="width: 15%;font-size: 75%">提交时间：<input
						type="radio" name="text_submit_date" value="0" checked />全部&nbsp;
						<input type="radio" name="text_submit_date" value="1" />当天&nbsp;
						<input type="radio" name="text_submit_date" value="2" />本周&nbsp;
						<input type="radio" name="text_submit_date" value="3" />本月&nbsp;
						<input type="radio" name="text_submit_date" value="4" />自定义<span
						id="submit_self_date" style="display: none">： <input
							type="text" id="text_submit_preDate" name="text_submit_preDate"
							readonly class="Wdate" style="height: 22px; width: 15%;"
							onclick="WdatePicker({startDate:'%y-%M-01',dateFmt:'yyyy-MM-dd',alwaysUseStartDate:true})" />&nbsp;至&nbsp;
							<input type="text" id="text_submit_postDate"
							name="text_submit_postDate" readonly class="Wdate"
							style="height: 22px; width: 15%;"
							onclick="WdatePicker({startDate:'%y-%M-01',dateFmt:'yyyy-MM-dd',alwaysUseStartDate:true})" /></span></label></td>
					<td colspan="5" >
						<button id="btn_examine_search"
							style="width: 80px; height: 28px; font-size: 14px; background-color: #3ea4e8; color: #fff">查&nbsp;询</button>
						<button id="btn_examine_empty"
							style="width: 80px; height: 28px; font-size: 14px; background-color: #3ea4e8; color: #fff">清&nbsp;空</button>
					</td>
				</tr>
			</table>
		</div>
	</div>
<div class="div div-2" style="overflow: auto;">
	<table id="examine_grid" style="display: none;padding: 0 0 0 0;"></table>
</div>
<div id="dlg_examine_details" style="display: none;">
		<table cellpadding="0" cellspacing="0"   style="text-align: center;width: 800px;height: 120px;">
			<thead>
				<tr>
					<td rowspan="6" style="font-size: 16px/1.5em;font-weight: bold;height: 30px;text-align: left;">申请账号信息</td>
				</tr>
			</thead>
			<tr>
				<td class="ctextrg w133"><label for="input_1" class="lbl-1">申请账号ID：</label></td>
				<td colspan="2" class="wi-align-l w266 hideContent" ><span
					id="ssb_examine_userId" ></span></td>
				<td class="ctextrg w133"><label for="input_1" class="lbl-1">测试账号：</label></td>
				<td colspan="2" class="wi-align-l w266 hideContent" ><span
					id="ssb_examine_isNo" class="hideContent"></span></td>
				<td class="ctextrg w133"><label for="input_1" class="lbl-1">账号昵称：</label></td>
				<td colspan="2" class="wi-align-l w266 hideContent" ><span
					id="ssb_examine_nickName" ></span></td>
			</tr>
			<tr>
				<td class="ctextrg w133"><label for="input_1" class="lbl-1">手机号码：</label></td>
				<td colspan="2" class="wi-align-l w266 hideContent"><span
					id="ssb_examine_phone"></span></td>
				<td class="ctextrg w133"><label for="input_1" class="lbl-1">联系QQ：</label></td>
				<td colspan="2" class="wi-align-l w266 hideContent"><span
					id="ssb_examine_contacts_qq"></span></td>
				<td class="ctextrg w133"><label for="input_1" class="lbl-1">所在地：</label></td>
				<td colspan="2" class="wi-align-l w266 hideContent"><span
					id="ssb_examine_sz_address"></span></td>
			</tr>
			<tr style="border-bottom: solid 1px;">
				<td class="ctextrg w133"><label for="input_1" class="lbl-1">注册时间：</label></td>
				<td colspan="2" class="wi-align-l w266 hideContent"><span
					id="ssb_examine_creatTime"></span></td>
				<td class="ctextrg w133"><label for="input_1" class="lbl-1">业务员：</label></td>
				<td colspan="2" class="wi-align-l w266 hideContent" ><span
					id="ssb_examine_ywyuan"></span></td>
			</tr>
		</table>
		<hr>
		<table cellpadding="0" cellspacing="0"  style="text-align: center;width: 800px;height: 100px;">
			<thead>
				<tr>
					<td rowspan="6" style="font-size: 16px/1.5em;font-weight: bold;height: 30px;text-align: left;">认证申请信息</td>
				</tr>
			</thead>
			<tr>
				<td class="ctextrg w133"><label for="input_1" class="lbl-1">申请时间：</label></td>
				<td colspan="2" class="wi-align-l w266 hideContent" ><span
					id="ssb_examine_applyTime"></span></td>
				<td class="ctextrg w133"><label for="input_1" class="lbl-1">公司注册地：</label></td>
				<td colspan="2" class="wi-align-l w266 hideContent"  ><span
					id="ssb_examine_resident"></span></td>
				<td class="ctextrg w133"><label for="input_1" class="lbl-1">公司名称：</label></td>
				<td colspan="2" class="wi-align-l w266 hideContent" ><span
					id="ssb_examine_company"></span></td>
			</tr>
			<tr>
				<td class="ctextrg w133"><label for="input_1" class="lbl-1">公司地址：</label></td>
				<td colspan="2"  class="wi-align-l w266 hideContent" ><span
					id="ssb_examine_company_address"></span></td>
			</tr>
		</table>
		<table cellpadding="0" cellspacing="0" style="text-align: center;width: 800px;height: 400px;">
			<tr>
				<td ><label for="input_1" class="lbl-1">组织机构号：</label></td>
				<td colspan="2" class="wi-align-l" ><span
					id="ssb_examine_organizationNo"></span></td>
				<td ><label for="input_1" class="lbl-1">税务登记号：</label></td>
				<td colspan="2" class="wi-align-l" ><span
					id="ssb_examine_taxRegistrationNo"></span></td>
			</tr>
			<tr>
				<td ><label for="input_1" class="lbl-1">组织机构证：</label></td>
				<td colspan="2" class="wi-align-l" ><input
					type="hidden" name="ssb_examine_organization"
					id="ssb_examine_organization" />
					<form method="post" enctype="multipart/form-data">
						<div id="imgShow"></div>
					</form></td>
				<td ><label for="input_1" class="lbl-1">税务登记号证：</label></td>
				<td colspan="2" class="wi-align-l" ><input
					type="hidden" name="ssb_examine_taxRegistration"
					id="ssb_examine_taxRegistration" />
					<form method="post" enctype="multipart/form-data">
						<div id="imgShow2"></div>
					</form>	
						</td>
			</tr>
			<tr>
				<td ><label for="input_1" class="lbl-1">营业执照号：</label></td>
				<td colspan="2" class="wi-align-l" ><span
					id="ssb_examine_businessLicenseNo"></span></td>
			</tr>
			<tr>
				<td ><label for="input_1" class="lbl-1">营业执照证：</label></td>
				<td colspan="2" class="wi-align-l" ><input
					type="hidden" name="ssb_examine_businessLicense"
					id="ssb_examine_businessLicense" />
					<form method="post" enctype="multipart/form-data">
						<div id="imgShow3"></div>
					</form>
					</td>
			</tr>
		</table>
		<hr>
		<table cellpadding="0" cellspacing="0" border="0" style="text-align: center;width: 800px;height: 150px;">
			<tr>
				<td class="ctextrg w133"><label for="input_1" class="lbl-1">法定代表人：</label></td>
				<td colspan="2" class="wi-align-l w266 hideContent" ><span
					id="ssb_examine_legalPerson"></span></td>
				<td class="ctextrg w133"><label for="input_1" class="lbl-1">公司电话：</label></td>
				<td colspan="2" class="wi-align-l w266 hideContent" ><span
					id="ssb_examine_companyPhone"></span></td>
				<td class="ctextrg w133"><label for="input_1" class="lbl-1">联系人：</label></td>
				<td colspan="2" class="wi-align-l w266 hideContent" ><span
					id="ssb_examine_contacts"></span></td>
			</tr>
			<tr>
				<td class="ctextrg w133"><label for="input_1" class="lbl-1">公司官网：</label></td>
				<td colspan="2" class="wi-align-l" ><span
					id="ssb_examine_website"></span></td>
			</tr>
			<tr>
			<td class="ctextrg w133"><label for="input_1" class="lbl-1">审核状态：</label></td>
				<td colspan="2" class="wi-align-l" ><span
					id="ssb_examine_status"></span></td>
				</tr>
		</table>
		<!-- <table cellpadding="0" cellspacing="0" border="0" class="table-1" id="ssb_examine_status_memu">
			<tr>
				<td style="width: 200px;"><label for="input_1" class="lbl-1">审核状态：</label></td>
				<td colspan="2" class="wi-align-1" style="width: 150px;">
				<span id="ssb_examine_status"></span></td>
			</tr>    
			<tr>
			<td style="width: 200px;"><label for="input_1" class="lbl-1">审核状态：</label></td>
				<td colspan="2" class="wi-align-l" style="width: 150px;"><span
					id="ssb_examine_status"></span>
				</td>
			</tr>
		</table> -->
		<hr>
		<table cellpadding="0" cellspacing="0" style="text-align: center;width: 800px;height: 100px;" id="ssb_examine_remark_memu">
			<tr>
				<td style="width: 200px;"><label for="input_1" class="lbl-1" >原因：</label></td>
				<td colspan="2" class="wi-align-l" style="height:40px;weight:200px;">
	            <div class="edit_area">
				<textarea class="input_textarea_320" id="ssb_examine_remark_lt" name="ssb_examine_remark_lt" cols="30" rows="5"></textarea>
				</div> <span id="ssb_examine_remark" class="label_area"></span></td>
			</tr>
		</table>
</div>
<script>
var selectedGridDiv = $("div.ui-tabs-panel.ui-widget-content.ui-corner-bottom:not(.ui-tabs-hide)");
var examineGridHeight = flexHeight("examine_grid");
var examine_grid;
var dlg_examine_details;
var examine = {
		bindExamineGrid : function(queryP) {
			examine_grid = $("#examine_grid").flexigrid({
				url:"examine!list.action?operation=init",
				colModel : [
					{display: '序号', name : 'xh', width : 40, align: 'center'},
					{display: 'id', name : 'ID', width : 70,  align: 'left', hide : true},
					{display: '申请账号ID', name : 'USERID', width : 100,  align: 'left'},
					{display: '申请账号昵称', name : 'NICKNAME', width : 100,  align: 'left'},
					{display: '注册地', name : 'RESIDENT', width : 70,  align: 'left',sortable: true,
						process:function(obj,pid){				
							if ($(obj).html() == 1) $(obj).html("境内");
							else if ($(obj).html() == 2) $(obj).html("境外");
							else $(obj).html("");
						}
					},
					{display: '公司名称', name : 'COMPANY', width : 80,  align: 'left'},
					{display: '组织机构号', name : 'ORGANIZATIONNO', width : 80,  align: 'left'},
					{display: '税务登记号', name : 'TAXREGISTRATIONNO', width : 80,  align: 'left'},
					{display: '营业执照号', name : 'BUSINESSLICENSENO', width : 80,  align: 'left'},
					{display: '法人', name : 'LEGALPERSON', width : 80,  align: 'left'},
					{display: '公司电话', name : 'PHONE', width : 80,  align: 'left'},
					{display: '联系人', name : 'CONTACTS', width : 80,  align: 'left'},
					{display: '审核状态', name : 'STATUS', width : 70,  align: 'left',sortable: true,
						process:function(obj,pid){				
							if ($(obj).html() == 0) $(obj).html("申请取消");
							else if ($(obj).html() == 1) $(obj).html("认证通过");
							else if ($(obj).html() == 2) $(obj).html("审核中");
							else if ($(obj).html() == 3) $(obj).html("认证失败");
							else if ($(obj).html() == 4) $(obj).html("待审核");
							else $(obj).html("");
						}
					},
					{display: '提交时间', name : 'CREATETIME', width : 70,  align: 'center',sortable: true},
					{display: '审核时间', name : 'APPROVETIME', width : 70,  align: 'center',sortable: true},
					{display: '审核人', name : 'APPROVED', width : 100,  align: 'center',sortable: true}
				],
				buttons :queryP,
				rowId:"xh",
				showToggleBtn: true,
				usepager: true,
				title:"企业审核认证",
				rp:page_num,
				showTableToggleBtn: false,
				resizable: false,
				height: examineGridHeight,
				singleSelect: true,
				onChangePage:examine.loadData,
				checkbox:false,
				filterParams : [{key : "nickname", name : "#txt_apply_nickname"},
				                {key : "istest", name : "#txt_istest_admin"},
								{key : "status", name : "#txt_examine_status"},
								{key : "company", name : "#txt_company_name"},
								{key : "resident", name : "#txt_resident_address"},
								{key : "legalPerson", name : "#txt_legal_person"},
								{key : "organization", name : "#txt_organization_no"},
								{key : "taxRegistration", name : "#txt_taxRegistration_no"},
								{key : "businessLicense", name : "#txt_businessLicense_no"},									
								{key : "dateType", name : "[name=text_submit_date]:checked"},
								{key : "preDate", name : "#text_submit_preDate"},
								{key : "postDate", name : "#text_submit_postDate"},
								{key : "applyId", name : "#txt_apply_id"},
								{key : "applyPhone", name : "#txt_apply_phone"},
								{key : "szaddress", name : "#txt_sz_address"},
								{key : "salesman", name : "#txt_sales_man"},
								{key : "approvedman", name : "#txt_approved_man"}]
			});
		},
		// 加载数据
		loadData : function(param) {
			var queryP = {};
			queryP.pagenum = param.page?param.page:$('.pcontrol input', selectedGridDiv).eq(0).val();
			queryP.pagesize = param.rp?param.rp:$("[name=rp]", selectedGridDiv).eq(0).val();
			queryP.nickname = $('#txt_apply_nickname').val();
			queryP.istest = $('#txt_istest_admin').val();			
			queryP.status = $('#txt_examine_status').val();
			queryP.company = $('#txt_company_name').val();
			queryP.resident = $('#txt_resident_address').val();	
			queryP.legalPerson = $('#txt_legal_person').val();
			queryP.organizationNo = $('#txt_organization_no').val();
			queryP.taxRegistrationNo = $('#txt_taxRegistration_no').val();
			queryP.businessLicenseNo = $('#txt_businessLicense_no').val();		
			queryP.dateType = $('[name=text_submit_date]:checked').val();
			queryP.preDate = $('#text_submit_preDate').val();
			queryP.postDate = $('#text_submit_postDate').val();			
			queryP.applyId = $('#txt_apply_id').val();
			queryP.applyPhone = $('#txt_apply_phone').val();
			queryP.contactsqq = $('#txt_contacts_qq').val();
			queryP.szaddress = $('#txt_sz_address').val();
			queryP.salesman = $('#txt_sales_man').val();
			queryP.approvedman = $('#txt_approved_man').val();
			queryP.sortname = param.sortname? param.sortname : "";
			queryP.sortorder = param.sortorder? param.sortorder : "";
			$.ajax({
				type: "POST",
				url: "examine!list.action?operation=init",
				cache: false,
				data: queryP,
				success: function(msg){
					var data=eval("("+msg+")");
					try{
						examine_grid.flexAddData(data);
					}catch(e){
						showErrorMsg("查询充值信息出错！");
					}
				}
			});
		},
		//查看详情
		details:function(com, grid){
	        var dlgParent = $("#dlg_examine_details").parent();
            var dlgOwn = $("#dlg_examine_details").clone();
            dlg_examine_details = $("#dlg_examine_details").dialog({
				autoOpen: false,
				height:700,
				width:850,
				show: "slide",
				modal:true,
				cache:false,
				/* hide: "explode", */
				title:'参数',
				buttons:{
					"知道了":function(){
						dlgOwn.appendTo(dlgParent);
	                	$(this).dialog("destroy").remove();
					}
				},
			    close : function() {
                	dlgOwn.appendTo(dlgParent);
                	$(this).dialog("destroy").remove();
                }
			});
				if($('.trSelected', grid).length==1)
				{
					var id = $('.trSelected', grid).eq(0).find("td:eq(1)").text();
					$.ajax({
						type : "POST",
						url : "examine!selectDetails.action",
						cache : false,
						data : {
							id : id
						},
						success : function(msg) {
							var data = eval("(" + msg + ")");
							$("#ssb_examine_userId").text(data.USERID);
							
							$("#ssb_examine_isNo").text(data.NICKNAME);
							$("#ssb_examine_nickName").text(data.NICKNAME);
							$("#ssb_examine_phone").text(data.USERPHONE);
							$("#ssb_examine_contacts_qq").text(data.QQ);
							$("#ssb_examine_sz_address").text(data.REGISTPLACE);
							$("#ssb_examine_creatTime").text(data.USERCREATTIME);
							$("#ssb_examine_ywyuan").text(data.SALESMANID_A);
							$("#ssb_examine_applyTime").text(data.CREATETIME);
							
							$("#ssb_examine_company").text(data.COMPANY);
							$("#ssb_examine_company_address").text(data.ADDRESS);
							$("#ssb_examine_organizationNo").text(data.ORGANIZATIONNO);
							$("#ssb_examine_taxRegistrationNo").text(data.TAXREGISTRATIONNO);
							$("#ssb_examine_organization").val(data.ORGANIZATION);
							$("#ssb_examine_taxRegistration").val(data.TAXREGISTRATION);
							$("#ssb_examine_businessLicenseNo").text(data.BUSINESSLICENSENO);
							$("#ssb_examine_businessLicense").val(data.BUSINESSLICENSE);
							$("#ssb_examine_legalPerson").text(data.LEGALPERSON);
							$("#ssb_examine_companyPhone").text(data.PHONE);
							$("#ssb_examine_contacts").text(data.CONTACTS);
							$("#ssb_examine_website").text(data.WEBSITE);
							var html = "";
							if (parseInt(data.STATUS) == 1){
								html ="认证通过";
								$("#ssb_examine_remark").text(data.REMARK);	
							}else if (parseInt(data.STATUS) == 2){
								html ="审核中";
							}else if (parseInt(data.STATUS) == 3){
								html ="认证失败";
								$("#ssb_examine_remark").text(data.REMARK);	
							}else if (parseInt(data.STATUS) == 4){		
								html = "待审核";
							}else if (parseInt(data.STATUS) == 0){		
								html = "申请取消";
							}	
							$("#ssb_examine_status").text(html);
							//$("#ssb_examine_remark").text(data.REMARK);	
							
							if (data.RESIDENT == 1) data.RESIDENT="境内";
							else if (data.RESIDENT == 2) data.RESIDENT="境外";	
							$("#ssb_examine_resident").text(data.RESIDENT);
							var picture = (data.picture);
							$("#imgShow").html("<img width='101px' src='"+picture+$("#ssb_examine_organization").val()+"'/>");
							$("#imgShow2").html("<img width='101px' src='"+picture+$("#ssb_examine_taxRegistration").val()+"'/>");
							$("#imgShow3").html("<img width='101px' src='"+picture+$("#ssb_examine_businessLicense").val()+"'/>");
							 $(".label_area").show();
							 $(".edit_area").hide();
							dlg_examine_details.dialog("option", "title", '企业审核认证').dialog("open");
						}});
				}
				else if($('.trSelected', grid).length>1)
				{
				    $('#dlg_examine_details').dialog('close');
					showMsg("不能同时选择多行记录！");
				}else
				{
				    $('#dlg_examine_details').dialog('close');
					showMsg("未选中行！");
				}
			
		},
		//刷新
		refresh:function(com, grid){
			examine.loadData({});
		},
		//审核
		companyExamine:function(com, grid){
	        var dlgParent = $("#dlg_examine_details").parent();
            var dlgOwn = $("#dlg_examine_details").clone();
            var userId = $('.trSelected', grid).eq(0).find("td:eq(2)").text();
            dlg_examine_details = $("#dlg_examine_details").dialog({
				autoOpen: false,
				height:700,
				width:850,
				show: "slide",
				modal:true,
				cache:false,
				/* hide: "explode", */
				title:'参数',
				buttons:{
					"审核通过":function(){
						var status =1;
						examine.saveParam(status,id,userId);
					},
					"审核不通过":function(){
						var status =3;
						examine.saveParam(status,id,userId);
					}
				},
			    close : function() {
                	dlgOwn.appendTo(dlgParent);
                	$(this).dialog("destroy").remove();
                }
			});
				if($('.trSelected', grid).length==1)
				{
					var id = $('.trSelected', grid).eq(0).find("td:eq(1)").text();
					var status = $('.trSelected', grid).eq(0).find("td:eq(12)").text();	
					if(status =="申请取消"){
						 $('#dlg_examine_details').dialog('close');
						showMsg("认证申请已取消,无法审核");
						return;
					}
					if(status =="认证通过"){
						 $('#dlg_examine_details').dialog('close');
						showMsg("认证申请已审核过,无法再次审核");
						return;
					}
					if(status =="认证失败"){
						 $('#dlg_examine_details').dialog('close');
						showMsg("认证申请已审核过,无法再次审核");
						return;
					}
					$.ajax({
						type : "POST",
						url : "examine!selectUpdateDetails.action",
						cache : false,
						data : {
							id : id
						},
						success : function(msg) {
							var data = eval("(" + msg + ")");
							$("#ssb_examine_userId").text(data.USERID);
							$("#ssb_examine_isNo").text(data.NICKNAME);
							$("#ssb_examine_nickName").text(data.NICKNAME);
							$("#ssb_examine_phone").text(data.USERPHONE);
							$("#ssb_examine_contacts_qq").text(data.QQ);
							$("#ssb_examine_sz_address").text(data.REGISTPLACE);
							$("#ssb_examine_creatTime").text(data.USERCREATTIME);
							$("#ssb_examine_ywyuan").text(data.SALESMANID_A);
							$("#ssb_examine_applyTime").text(data.CREATETIME);
							$("#ssb_examine_resident").text(data.RESIDENT);
							$("#ssb_examine_company").text(data.COMPANY);
							$("#ssb_examine_company_address").text(data.ADDRESS);
							$("#ssb_examine_organizationNo").text(data.ORGANIZATIONNO);
							$("#ssb_examine_taxRegistrationNo").text(data.TAXREGISTRATIONNO);
							$("#ssb_examine_organization").val(data.ORGANIZATION);
							$("#ssb_examine_taxRegistration").val(data.TAXREGISTRATION);
							$("#ssb_examine_businessLicenseNo").text(data.BUSINESSLICENSENO);
							$("#ssb_examine_businessLicense").val(data.BUSINESSLICENSE);
							$("#ssb_examine_legalPerson").text(data.LEGALPERSON);
							$("#ssb_examine_companyPhone").text(data.PHONE);
							$("#ssb_examine_contacts").text(data.CONTACTS);
							$("#ssb_examine_website").text(data.WEBSITE);
							var picture = (data.picture);
							$("#imgShow").html("<img width='150px' src='"+picture+$("#ssb_examine_organization").val()+"'/>");
							$("#imgShow2").html("<img width='150px' src='"+picture+$("#ssb_examine_taxRegistration").val()+"'/>");
							$("#imgShow3").html("<img width='150px' src='"+picture+$("#ssb_examine_businessLicense").val()+"'/>");
							 $("#ssb_examine_status_memu").css("display", "none");
							 $(".label_area").hide();
							 $(".edit_area").show();
							dlg_examine_details.dialog("option", "title", '企业审核认证').dialog("open"); 
						}});
				}
				else if($('.trSelected', grid).length>1)
				{
				    $('#dlg_examine_details').dialog('close');
					showMsg("不能同时选择多行记录！");
				}else
				{
				    $('#dlg_examine_details').dialog('close');
					showMsg("未选中行！");
				}
		},
		//保存参数
		saveParam:function(status,id,userId)
		{
			var remark = $("#ssb_examine_remark_lt").val();
			var params=new Object();
			params.status = status;
			params.id =id;
			params.userId =userId;
			params.remark =remark;
			// 新增和编辑通用字符串
			var url ='';
			var indicate='';
			if (status == 1) 
			{
				indicate = "确认审核通过";
				url = "examine!updateCertifition.action";
			} else if (status == 3) 
			{
				if (remark.length == 0){
					showMsg("请输入不通过原因！");
					return;
				}
				if (remark.length > 50){
					showMsg("请输入不超过50位汉字！");
					return;
				}	
				indicate = "确认审核不通过";
				url = "examine!updateCertifition.action";
			}
			// 弹出确认框
			if(confirm(indicate)) 
			{
				$.ajax({
					type: "POST",
					url: url,
					cache: false,
					data: params,
					success: function(msg){
						var result=eval("("+msg+")");
						if (result.msg=="ok") 
						{
							showMsg("操作成功");
							$('#dlg_examine_details').dialog('close');
							examine.loadData({});
						} else 
						{
							showMsg(result.msg);
						}
					}
				}); 
			}
			else
			{
			    $('#dlg_plans_memu').dialog('close');
			}
		},	 	
		// 导出数据
		exportData : function() {
			var condition = "";
			var nickname = $('#txt_apply_nickname').val();
			var status = $('#txt_examine_status').val();
			var company = $('#txt_company_name').val();
			var resident = $('#txt_resident_address').val();	
			var legalPerson = $('#txt_legal_person').val();
			var organizationNo = $('#txt_organization_no').val();
			var taxRegistrationNo = $('#txt_taxRegistration_no').val();
			var businessLicenseNo = $('#txt_businessLicense_no').val();		
			var dateType = $('[name=text_submit_date]:checked').val();
			var preDate = $('#text_submit_preDate').val();
			var postDate = $('#text_submit_postDate').val();			
			var applyId = $('#txt_apply_id').val();
			var applyPhone = $('#txt_apply_phone').val();
			var contactsqq = $('#txt_contacts_qq').val();
			var szaddress = $('#txt_sz_address').val();
			var salesman = $('#txt_sales_man').val();
			var approvedman = $('#txt_approved_man').val();		
			var cols = new Array("USERID","NICKNAME","COMPANY","CREATETIME","STATUS","RESIDENT","ADDRESS"
					,"ORGANIZATIONNO","BUSINESSLICENSENO","TAXREGISTRATIONNO","LEGALPERSON","PHONE"
					,"CONTACTS","WEBSITE","REMARK","APPROVED","APPROVETIME");				
			if (company && company.length > 0) {					
				condition += "&company=" + company;
			}
			if (nickname && nickname.length > 0) {
				condition += "&nickname=" + nickname;
			}
			if (resident && resident.length > 0) {
				condition += "&resident=" + resident;
			}
			if (status && status.length > 0) {
				condition += "&status=" + statu;
			}
			if (legalPerson && legalPerson.length > 0) {
				condition += "&legalPerson=" + legalPerson;
			}
			if (organizationNo && organizationNo.length > 0) {
				condition += "&organizationNo=" + organizationNo;
			}
			if (taxRegistrationNo && taxRegistrationNo.length > 0) {
				condition += "&taxRegistrationNo=" + taxRegistrationNo;
			}
			if (businessLicenseNo && businessLicenseNo.length > 0) {
				condition += "&businessLicenseNo=" + businessLicenseNo;
			}
			if (dateType && dateType.length > 0) {
				condition += "&dateType=" + dateType;
			}
			if (preDate && preDate.length > 0) {
				condition += "&preDate=" + preDate;
			}
			if (postDate && postDate.length > 0) {
				condition += "&postDate=" + postDate;
			}
			if (applyId && applyId.length > 0) {
				condition += "&applyId=" + applyId;
			}
			if (applyPhone && applyPhone.length > 0) {
				condition += "&applyPhone=" + applyPhone;
			}
			if (contactsqq && contactsqq.length > 0) {
				condition += "&contactsqq=" + contactsqq;
			}
			if (szaddress && szaddress.length > 0) {
				condition += "&szaddress=" + szaddress;
			}
			if (salesman && salesman.length > 0) {
				condition += "&salesman=" + salesman;
			}
			if (approvedman && approvedman.length > 0) {
				condition += "&approvedman=" + approvedman;
			}
			location.href='examine!export.action?'+condition + '&columns=' + JSON.stringify(cols);
		},		
		
		// 验证规则
		validate : function() {
			var flg = true;
			$("#dlg_plansManage input").each(function() {
				if (!$(this).validate()) flg = false;
			});
			return flg;
		}
};
$(function(){
	//初始化所有操作按钮
	 var  parm_button = [	{name: '审核', bclass: 'edit', onpress : examine.companyExamine},
							{name: '查看详情', bclass: 'search', onpress : examine.details},
							{name: '导出', bclass: 'excel', onpress : examine.exportData}
						];
	 //权限操作按钮
	 var buttons = [];	 
	 //获得当前菜单的id
	 var menu_id;
	 $('#tabs ul li').each(function(){
		if($(this).hasClass("ui-tabs-selected")){
			var this_id = $(this).children("div").children("a").attr("href");
			menu_id =this_id.substring(5);
			}
		}); 
	 // 根据菜单id，初始化操作按钮
	 $.ajax({
		type: "GET",
		url: "doauth!getButtons.action?menu_id="+menu_id,
		cache: false,
		success: function(data){
			var data=eval("("+data+")");
			for (var i in data.buttons) {
				var buttonName = data.buttons[i].BUTTON_NAME;
				$(parm_button).each(function(index){
					var val = parm_button[index].name;
					if(val == buttonName){
						buttons.push(parm_button[index]);
						buttons.push({separator: true});
					}
				});
			}
  			// 初始化数据
			examine.bindExamineGrid(buttons);
		}
	});
	/*查询按钮功能*/
	$('#btn_examine_search').button({ icons: {primary:'ui-icon-search'} }).on("click",function(){
		examine.loadData({page : 1});
	});	
	 $('#btn_examine_empty').on("click",function(){
		$('#txt_apply_nickname').val("");
		$('#txt_examine_status').val("");
		$('#txt_company_name').val("");
		$('#txt_resident_address').val("");	
		$('#txt_legal_person').val("");
		$('#txt_organization_no').val("");
		$('#txt_taxRegistration_no').val("");
		$('#txt_businessLicense_no').val("");		
		$('#text_submit_preDate').val("");
		$('#text_submit_postDate').val("");			
		$('#txt_apply_id').val("");
		$('#txt_apply_phone').val("");
		$('#txt_sz_address').val("");
		$('#txt_sales_man').val("");
		$('#txt_approved_man').val("");
		$('#txt_istest_admin').val("");
		$('#txt_contacts_qq').val("");
		$('[name=text_submit_date]').attr("checked",false);
		$("#submit_self_date").hide();
		$('[name=text_submit_date][value=0] ').attr("checked",true);
	}); 
	
     
	// 绑定日期个格式radio变化的问题
	$("[name=text_submit_date]").change(function() {
		var dateType = $('[name=text_submit_date]:checked').val();
		if (dateType == '4') {
			$("#submit_self_date").show();
		} else {
			$("#submit_self_date").hide();
		}
	});	
});
	</script>
